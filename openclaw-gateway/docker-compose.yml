services:
  gateway:
    build: .
    container_name: openclaw-gateway
    restart: unless-stopped
    ports:
      - "8765:8765"   # WebSocket (agent connection)
      - "8766:8766"   # HTTP API (for external SKYNET if needed)
    volumes:
      - gateway-data:/app/data
      - ${OPENCLAW_TLS_CERT_DIR:-./certs}:/app/certs:ro
    environment:
      # Required
      - OPENCLAW_AUTH_TOKEN
      - TELEGRAM_BOT_TOKEN
      # AI providers (optional - set whichever you have)
      - GOOGLE_AI_API_KEY
      - GROQ_API_KEY
      - OPENROUTER_API_KEY
      - DEEPSEEK_API_KEY
      - OPENAI_API_KEY
      - ANTHROPIC_API_KEY
      # Search
      - BRAVE_SEARCH_API_KEY
      # GitHub
      - GITHUB_PAT
      - GITHUB_USERNAME
      # AWS S3
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-us-east-1}
      - AWS_REGION=${AWS_REGION:-us-east-1}
      - SKYNET_S3_BUCKET
      # TLS (paths inside container)
      - OPENCLAW_TLS_CERT=/app/certs/cert.pem
      - OPENCLAW_TLS_KEY=/app/certs/key.pem
      # Gateway HTTP bind (set 0.0.0.0 for container-to-container access)
      - OPENCLAW_HTTP_HOST=${OPENCLAW_HTTP_HOST:-0.0.0.0}
      - OPENCLAW_HTTP_PORT=${OPENCLAW_HTTP_PORT:-8766}
      # Logging
      - OPENCLAW_LOG_LEVEL=${OPENCLAW_LOG_LEVEL:-INFO}
      # Optional SSH tunnel fallback (no local worker install on laptop)
      - OPENCLAW_EXECUTION_MODE
      - OPENCLAW_SSH_FALLBACK_ENABLED
      - OPENCLAW_SSH_HOST
      - OPENCLAW_SSH_PORT
      - OPENCLAW_SSH_USER
      - OPENCLAW_SSH_PASSWORD
      - OPENCLAW_SSH_KEY_PATH
      - OPENCLAW_SSH_CONNECT_TIMEOUT
      - OPENCLAW_SSH_COMMAND_TIMEOUT
      - OPENCLAW_SSH_HEALTH_CACHE_SECONDS
      - OPENCLAW_SSH_REMOTE_OS
      - OPENCLAW_SSH_ALLOWED_ROOTS
      - OPENCLAW_SSH_STRICT_HOST_KEY
      - OPENCLAW_SSH_CODEX_BIN
      - OPENCLAW_SSH_CLAUDE_BIN
      - OPENCLAW_SSH_CLINE_BIN
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  gateway-data:
    driver: local
